
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UC Payment</title>
</head>
<body style="background:#121212; color:white; font-family:sans-serif; text-align:center; padding:20px;">
  <h1>ğŸ’³ Bli UC Automatikisht</h1>

  <form id="uc-form" style="margin-top:30px;">
    <label for="ucProductId">Zgjidh paketÃ«n:</label><br><br>
    <select id="ucProductId" required>
      <option value="" disabled selected>Zgjidh njÃ«</option>
      <option value="1938299181721538561" data-amount="4.10" data-uc="325">325 UC â€“ â‚¬4.10</option>
      <option value="1938300815303401474" data-amount="8.10" data-uc="660">660 UC â€“ â‚¬8.10</option>
      <option value="1931436511665717249" data-amount="20.50" data-uc="1800">1800 UC â€“ â‚¬20.50</option>
      <option value="1898646498683515844" data-amount="41.50" data-uc="3850">3850 UC â€“ â‚¬41.50</option>
      <option value="1909194994574553089" data-amount="80.00" data-uc="8100">8100 UC â€“ â‚¬80.00</option>
    </select><br><br>

    <input type="text" id="playerId" placeholder="Player ID" required /><br><br>
    <input type="text" id="serverId" placeholder="Server ID" required /><br><br>

    <button type="submit" id="payWithStripe">ğŸ’³ Paguaj me kartÃ«</button>
    <div id="auto-confirm" class="status" style="margin-top:15px; color:#0f0;"></div>
  </form>

  <script>
    document.getElementById("uc-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const select = document.getElementById("ucProductId");
      const selectedOption = select.options[select.selectedIndex];
      const productId = select.value;
      const amount = parseFloat(selectedOption.getAttribute("data-amount"));
      const ucAmount = parseInt(selectedOption.getAttribute("data-uc"));

      const playerId = document.getElementById("playerId").value.trim();
      const serverId = document.getElementById("serverId").value.trim();

      if (!playerId || !serverId) {
        alert("Ju lutem shkruani Player ID dhe Server ID.");
        return;
      }

      document.getElementById("auto-confirm").innerText = "â³ Duke krijuar pagesÃ«n...";

      const res = await fetch("/.netlify/functions/createCheckoutSession", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          productId,
          playerId,
          serverId,
          amount,
          ucAmount
        })
      });

      const result = await res.json();
      if (result.url) {
        window.location.href = result.url;
      } else {
        document.getElementById("auto-confirm").innerText = "âŒ DÃ«shtoi krijimi i pagesÃ«s.";
      }
    });
  </script>
</body>
</html>
